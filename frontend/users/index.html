<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestionar Edificaciones</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        h1 {
            margin-top: 0.5em;
            text-align: center;
        }
        img {
            max-width: 100%;
            max-height: 100%;
        }
        #texto {
            text-align: right;
        }
        p {
            font-size: 20px;
            padding-left: 20px;
            text-align: justify;
        }
        #info {
            background-color: #30303A;
            border-radius: 1em;
            padding: 0.5em;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        h2 {
            margin-top: 0.5em;
            margin-left: 1em;
        }
        .edificio-card {
            margin: 20px;
        }
        .centrado {
            display: flex;
            justify-content: center;
        }
    </style>
</head>
<body data-bs-theme="dark">
    <div class="container">
        <div class="row">
            <div class="col">
                <h1 id="titulo">Gestionar Edificaciones</h1>
            </div>
        </div>
    </div>

    <div class="container" id="info">
        <div class="row g-4 centrado" id="edificaciones">
            <div class="col-md-4 edificio-card">
                <div class="card">
                    <img src="cañon.png" class="card-img-top edificio-image" alt="Cañón">
                    <div class="card-body">
                        <h5 class="card-title">Cañón</h5>
                        <p class="card-text">Genera dinero para tu imperio. Nivel: <span id="nivel-can">1</span></p>
                        <button class="btn btn-primary" onclick="subirNivel('can')">Subir de Nivel</button>
                    </div>
                </div>
            </div>

            <div class="col-md-4 edificio-card">
                <div class="card">
                    <img src="torre-arquera.png" class="card-img-top edificio-image" alt="Torre Arquera">
                    <div class="card-body">
                        <h5 class="card-title">Torre Arquera</h5>
                        <p class="card-text">Genera dinero para tu imperio. Nivel: <span id="nivel-torre">1</span></p>
                        <button class="btn btn-primary" onclick="subirNivel('torre')">Subir de Nivel</button>
                    </div>
                </div>
            </div>

            <div class="col-md-4 edificio-card">
                <div class="card">
                    <img src="ayuntamiento.png" class="card-img-top edificio-image" alt="Ayuntamiento">
                    <div class="card-body">
                        <h5 class="card-title">Ayuntamiento</h5>
                        <p class="card-text">Permite subir de nivel a otras edificaciones. Nivel: <span id="nivel-ayuntamiento">1</span></p>
                        <button class="btn btn-primary" onclick="subirNivel('ayuntamiento')">Subir de Nivel</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <h2 class="text-center mt-4">Ganancias Totales: $<div id="ganancia_total"></div></h2>
    <div class="container text-center mt-4" id="info">
        <button class="btn btn-success" onclick="recaudarGanancias()">Recaudar Todo</button>
    </div>

    <h2 class="text-center mt-4">Eliminar Personaje</h2>
    <div class="container text-center mt-4" id="info">
        <button class="btn btn-danger" onclick="eliminarPersonaje()">Eliminar Personaje</button>
    </div>

    <div id="mensaje-final" class="mt-4 text-center" style="display: none;">
        <h2 class="text-success">USTED HA GANADO</h2>
    </div>
    
    <script>
        // Función para subir de nivel una edificación
        function subirNivel(tipo) {
            console.log(`Subiendo nivel del ${tipo}`);
            document.getElementById(`nivel-${tipo}`).textContent = parseInt(document.getElementById(`nivel-${tipo}`).textContent) + 1;
            verificarVictoria();
        }

        // Función para recaudar todas las ganancias
        /*function recaudarGanancias() {
            console.log('Recaudando todas las ganancias');
            let ganancias = parseInt(document.getElementById('ganancias-totales').textContent);
            // Aquí podrías agregar la lógica de incremento de ganancias
        }*/


        function response_received(response) {
            return response.json()
        }
        function request_error(error) {
            console.log("ERROR");
            console.log(error);
        }

        let monto_inicial, torre_tipo, cañon_tipo;

        function parse_data_monto(content){
            monto_inicial = content.money;
            torre_tipo=content.Archer_Tower;
            cañon_tipo= content.Canon;
            }  
            
        let torre_ganancia;
        function parse_tower(content){
            torre_ganancia= content[torre_tipo].money_given;
            }
            
        let cañon_ganancia;		
        function parse_canon(content){
            torre_ganancia= content[cañon_tipo].money_given;
            }         

        function recaudarGanancias(){
            fetch("http://127.0.0.1:5000/users/"+id)
                        .then(response_received)  
                        .then(parse_data_monto)           
                        .catch(request_error)

            fetch("http://127.0.0.1:5000/archertower")
                        .then(response_received)  
                        .then(parse_tower)
                        .catch(request_error) 
                
            fetch("http://127.0.0.1:5000/canon")
                        .then(response_received)  
                        .then(parse_canon)
                        .catch(request_error)	

            let cobro_total= torre_ganancia + cañon_ganancia + monto_inicial;
            //aca falta un post para guardar en el money del usuario lo acumulado recien..
            
            
            
            const container = document.getElementById("ganancia_total")
            const monto = document.createElement("p")
            monto.InnerText= cobro_total
            container.appendChild(monto);
        }



        // Función para eliminar el personaje
        function eliminarPersonaje() {
            if (confirm('¿Estás seguro de que quieres eliminar este personaje?')) {
                console.log('Eliminando personaje');
                window.location.href = 'index.html';
            }
        }

        // Función para verificar si se ha ganado
        function verificarVictoria() {
            let nivelCañon = parseInt(document.getElementById('nivel-can').textContent);
            let nivelTorre = parseInt(document.getElementById('nivel-torre').textContent);
            let nivelAyuntamiento = parseInt(document.getElementById('nivel-ayuntamiento').textContent);

            if (nivelCañon >= 10 && nivelTorre >= 10 && nivelAyuntamiento >= 10) {
                document.getElementById('mensaje-final').style.display = 'block';
                document.querySelectorAll('.btn').forEach(btn => btn.disabled = true);
            }
        }
    </script>
</body>
</html>
